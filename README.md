# WhatsApp Twilio API

This project provides a simple API to send WhatsApp messages using the Twilio API. It is built with FastAPI.

## Project Structure

```
.
├── .env
├── main.py
├── test.py
└── .venv_pytwilio/
```

## Setup and Installation

### 1. Clone the Repository

```bash
git clone https://github.com/Chitraksh-Sharma/twilio-whatsapp-api.git
cd twilio_whatsapp
```

### 2. Create and Activate Virtual Environment

It is recommended to use a virtual environment to manage project dependencies.

```bash
# For Windows
python -m venv .venv_pytwilio
.venv_pytwilio\Scripts\activate

# For macOS/Linux
python3 -m venv .venv_pytwilio
source .venv_pytwilio/bin/activate
```

### 3. Install Dependencies

Install the required Python libraries.

```bash
pip install fastapi uvicorn python-dotenv twilio
```

### 4. Configure Environment Variables

Create a `.env` file in the root directory of the project and add your Twilio credentials:

```
TWILIO_ACCOUNT_SID="your_account_sid"
TWILIO_AUTH_TOKEN="your_auth_token"
```

Replace `"your_account_sid"` and `"your_auth_token"` with your actual Twilio Account SID and Auth Token.

### 5. Twilio WhatsApp Sandbox Setup

Follow these steps to configure the Twilio WhatsApp Sandbox for testing.

#### Step 1: Create a Twilio Account
- Go to the [Twilio Console](https://www.twilio.com/console).
- Sign up for a free account.
- Verify your email and phone number.

#### Step 2: Get Your Credentials
- In the Twilio Console, find your **Account SID** (starts with `AC...`) and **Auth Token**.
- Copy these values into your `.env` file.

#### Step 3: Enable WhatsApp Sandbox
- Navigate to **Messaging → Try It Out → WhatsApp Sandbox**.
- Note your Sandbox Number: `whatsapp:+14155238886`.
- Add your personal WhatsApp number to the sandbox participants list.
- To join, send the join phrase (e.g., "join <your-keyword>") from your phone to the sandbox number.

#### Sandbox Limitations

- **Recipient Limitations:**
    - Only sandbox participants can receive messages.
    - You must manually add each number to the sandbox.
    - A maximum of 250 numbers can be in the sandbox.
    - Numbers must send the "join" message first to become a participant.
- **Sending Limits:**
    - A maximum of 250 messages per day.
    - The service is rate-limited, so you cannot send bulk messages quickly.
    - No automated scaling for the sandbox environment.

### 6. Run the Application

Start the FastAPI server using uvicorn.

```bash
uvicorn main:app --reload
```

The application will be running at `http://127.0.0.1:8000`.

## API Documentation

The API documentation is automatically generated by FastAPI and is available at `http://127.0.0.1:8000/docs` when the application is running.

### Endpoints

-   **`GET /`**: Root endpoint with a welcome message.
-   **`GET /status`**: Checks the API and Twilio configuration status.
-   **`POST /send-message`**: Sends a WhatsApp message.
-   **`POST /send-bulk-message`**: Sends a WhatsApp message to multiple number
-   **`GET /health`**: Health check endpoint.

#### `POST /send-message`

**Request Body:**

```json
{
  "to": "whatsapp:+1234567890",
  "message": "Hello! This is a test message."
}
```

#### `POST /send-bulk-message`

**Request Body:**

```json
{
  "numbers": ["whatsapp:+911234567890", "whatsapp:+919876543210"],
  "message": "Hello from FastAPI bulk sender!"
}
```

**Response (Success):**

```json
{
  "success": true,
  "message_sid": "SMxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
  "status": "queued",
  "error": null
}
```

**Response (Error):**

```json
{
  "success": false,
  "message_sid": null,
  "status": null,
  "error": "Error message"
}
```

## Testing

To run the tests, first install the required libraries:
```bash
pip install pytest httpx
```
Then, execute the `test.py` file with pytest.

```bash
pytest
```
